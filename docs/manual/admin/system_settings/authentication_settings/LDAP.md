# LDAP 认证

## 关于 LDAP

!!! tip "LDAP"
    - **轻量级目录访问协议（LDAP）** 是一种开放协议，用于访问和管理分布式目录信息。它通常用于集中式身份验证和目录服务，例如存储用户帐户、权限和组织结构信息。LDAP 广泛应用于企业身份管理、单点登录（SSO）和访问控制系统。
    - **可分辨名称 （DN）** 是 LDAP 目录中每个条目的唯一标识符，类似于文件系统中的文件路径，例如“cn=admin，ou=Users，dc=example，dc=com”。
    - **组织单位 （OU）** 用于组织和管理 LDAP 目录中的对象，类似于文件系统中的文件夹。例如，一个组织可能有多个 OU “ou=HR” 和 “ou=IT”，以区分不同部门的用户和资源。

## 如何配置

!!! tip ""
    - 在页面右上角，单击设置
    - 导航到 **系统设置>身份验证> LDAP。**
    - 在 **LDAP** 字段中，选中以启用 LDAP 身份验证。
    - 在 **服务器** 字段中，键入 LDAP 服务器 URI，例如“ldap://example.com:389”和“ldaps://example.com:636”。

!!! tip "Tip"
    - 要配置 LDAP TLS 证书，您可以将文件“ldap_ca.pem、ldap_cert.pem、ldap_cert.key”上传到目录“/data/jumpserver/core/data/certs”，然后重新启动服务。
!!! tip ""               
    - 在 **绑定 DN** 字段中，键入至少具有查询权限的用户 DN，该权限将用于查询和筛选用户，例如“cn=admin，dc=example，dc=com”。

    - 在 **密码** 字段中，键入“绑定 DN”用户的密码。

    - 在 **用户 OU** 字段中，键入搜索 OU 以指定从何处开始搜索用户，用于分隔多个值，例如“ou=users，dc=example，dc=com |ou=tech，dc=example，dc=com“。`|`

    - 在 **用户过滤器** 字段中，键入过滤器表达式以搜索 LDAP 用户。默认情况下，表达式为“（cn=%（user）s）”，其中“%（user）s”是 Python 中的占位符语法。在过滤过程中，它被替换为 ，生成“（cn=*）”，它搜索所有用户。您还可以将“cn”替换为实际的用户名字段，例如“uid”或“sAMAccountName”。`*`

    - 在 **映射属性** 字段中，键入用户属性映射。键表示 JumpServer 用户属性名称（可用选项：名称、用户名、电子邮件、is_active、组、电话、评论），而该值对应于 LDAP 用户属性名称。

LDAP 用户属性示例

```
{  
    "name": "cn",
	"email": "mail",  
	"username": "cn",  
	"is_active": "useraccountcontrol",  
	"groups": "memberOf"
}
```
!!! tip ""
    - 在 **连接超时时间** 字段中，键入 LDAP 连接超时（以秒为单位）。

    - 在 **搜索分页数量（条）** 字段中，键入搜索用户的页面大小。

    - 在 **User DN 缓存超时时间 （秒）** 字段中，键入用户 DN 的缓存持续时间（以秒为单位），以提高登录身份验证速度。如果用户 DN 发生更改，请提交表单以清除缓存，否则身份验证将失败。

    - 单击 **提交。**


## 测试 LDAP 连接
!!! tip ""
    - 在页面右上角，单击设置。

    - 导航到 **系统设置>认证设置> LDAP。**

    - 滚动到页面底部。

    - 单击 **测试连接**。

## 测试 LDAP 登录
!!! tip ""
    - 在页面右上角，单击设置。

    - 导航到 **系统设置>认证设置> LDAP。**

    - 已成功完成并测试 LDAP 配置。

    - 滚动到页面底部。

    - 单击 **测试登录。**

    - 在弹出窗口中，键入 LDAP 用户的用户名和密码。

    - 单击 **确认**。

## 导入 LDAP 用户
!!! tip ""
    - 在页面右上角，单击设置。

    - 导航到 **系统设置>认证设置> LDAP。**

    - 已成功完成并测试 LDAP 配置。

    - 滚动到页面底部。

    - 单击 **用户导入**。

    - 在弹出的窗口中，您可以通过以下方式导入 LDAP 用户。

    - 单击 **同步用户** 将LDAP 用户同步到表。

    - 在 **导入组织** 字段中，选择要导入的一个或多个组织。

    - 选中要导入的用户，点击 **导入** 继续 。

    - 或者，您可以单击 **全部导入**  以导入所有用户。

![LDAP图1](../../../../img/V4_LDAP1.png)

## 设置 LDAP 用户同步
!!! tip ""

    - 在页面右上角，单击设置

    - 导航到 **系统设置>身份验证> LDAP。**

    - 已成功完成并测试 LDAP 配置。

    - 滚动到页面底部。

    - 点击 **同步设置**。

    - 在弹出窗口中，键入要配置的以下信息。

    - 在 **组织** 字段中，选择要同步的一个或多个组织。

    - 在 **周期执行** 字段中，选中以启用周期执行。

    - 在 **定时任务** 字段中，键入 crontab 表达式。如果为空，则使用“间隔”。

    - 在 **间隔** 字段中，键入同步间隔（以小时为单位）。

    - 但是，如果 **定时任务** 有值，则 **定时任务** 将优先。

    - 在 **收件人** 字段中，选择一个或多个用户以接收同步结果。

    - 单击 **确认**。

![LDAP图2](../../../../img/V4_LDAP2.png)

