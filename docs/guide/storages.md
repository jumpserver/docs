# 存储说明

## 1 命令存储
### 1.1 在 JumpServer 页面添加 Elasticsearch 配置信息
!!! tip ""
    - 点击 `系统设置` - `存储设置` - `命令存储` - `创建` - `Elasticsearch` 切换到新建命令存储界面。

    | 名称     | 示例                    | 说明            |
    | :------- | :--------------------- | :-------------- |
    | 名称     | jms_es                  | 标识用, 不可重复 |
    | 类型     | Elasticsearch           | 必填, 无法更改   |
    | 主机     | http://172.16.11.3:9200 | http://es_user:es_password@es_host:es_port |
    | 索引     | jumpserver              | 索引             |
    | 默认存储 | √                       | 默认存储         |
    | 备注     | es 测试服务器            | 仅标识, 可不填   |     

### 1.2 修改命令存储为 Elasticsearch
!!! tip ""
    - 在 `组件管理` 页面选择 `更新` 组件，把命令存储修改成刚才创建的 ES 服务器即可。
    - 勾选 `默认存储` 后，新注册的组件将会自动使用默认存储不需要再次修改，但是旧组件要更新才能生效。
    - 如果 `Elasticsearch` 使用了非信任证书，需要勾选 `忽略证书认证`。
    - 修改完成后，大概需要 1 分钟的时间完成同步。

### 1.3 重启组件服务
!!! tip ""
    - 重启 KoKo 组件服务，使配置生效。

    ```sh
    docker restart jms_koko
    ```


## 2 录像存储
### 2.1 操作过程
!!! tip ""
    - 点击 `系统设置` - `存储设置` - `对象存储` - `创建` 切换到新建录像存储界面。
    - 在 `组件管理` 页面选择 `更新` 组件。
    - 之前已经存储在本地的录像需要自己手动上传到你新的存储环境。
    - 勾选 `默认存储` 后，新注册的组件将会自动使用默认存储不需要再次修改，但是旧组件要更新才能生效。
    - 选择你需要的存储方式即可，大概需要 1 分钟的时间完成同步。


## 3 日志存储
### 3.1 对接 Syslog 服务
!!! tip ""
    - 打开 config.txt 配置文件。

    ```sh
    vi /opt/jumpserver/config/config.txt
    ```

!!! tip ""
    - 加入 Syslog 相关设置。

    ```vim
    # Syslog 相关设置
    SYSLOG_ENABLE=True
    SYSLOG_ADDR=192.168.100.215:514   # Syslog 服务器的IP以及端口
    ```

!!! tip ""
    - 重启 JumpServer 服务。
    
    ```sh
    ./jmsctl.sh restart
    ```
