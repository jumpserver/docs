快速入门
==================

说明
``````````
- Jumpserver 包含 core koko guacamole luna 4 个组件, 常用名称 jms_core jms_koko jms_guacamole jms_luna
- 正常部署完成后，可以参考此文档快速入门
- 如果遇到问题，可以参考 FAQ 文档
- 以下操作, 均在 Web 页面完成, 请使用 admin 用户登陆, 默认密码 admin, 之后注意自行改密

一、系统设置
````````````````````

**1.1 基本设置**
----------------

.. code-block:: vim

    # 修改 当前站点URL 为你的实际 url 地址, 否则邮件收到的地址不正确 也无法创建新用户
    # 用户向导URL 可以是你内网的 wiki 文档, 或者其他 docs 说明文档, 没有也可以留空

**1.2 邮件设置**
----------------

.. code-block:: vim

    # 点击页面上边的"邮件设置", 进入邮件设置页面
    # 默认使用 25 端口, 不勾选 SSL 和 TLS; 如果需要勾选 SSL, 端口需要修改成 465; 如果需要勾选 TLS, 端口需要改成 587
    # 不可以同时勾选 SSL 和 TLS
    # 发送账号一定要填
    # 配置邮件服务后, 点击页面的"测试连接"按钮, 如果配置正确, JumpServer 会发送一条测试邮件到您的 SMTP 账号邮箱里面, 确定收到测试邮件后点击保存即可使用

二、资产管理
``````````````````
- 准备两个测试资产和一个数据库来验证功能

+--------------+-----------------+------------+------------+---------------+---------------+
|      IP      |    Host name    |    Port    |   System   |  Admin User   |    Password   |
+==============+=================+============+============+===============+===============+
| 172.16.80.11 |    test_ssh01   |     22     |  Centos 7  |      root     |  Test@2020.L  |
+--------------+-----------------+------------+------------+---------------+---------------+
| 172.16.80.21 |    test_rdp01   |    3389    | Windows 10 | administrator |  Test@2020.W  |
+--------------+-----------------+------------+------------+---------------+---------------+
| 172.16.80.31 |   test_mysql01  |    3306    |   Mysql 5  |      root     |  Test@2020.M  |
+--------------+-----------------+------------+------------+---------------+---------------+

Windows 资产先进行如下操作 `Windows SSH 设置说明 <faq_rdp.html>`_

Mysql Server 需要授权 core 和 koko 的远程访问, 测试环境可以用 'root'@'%'

.. code-block:: vim
    $ mysql -uroot
    $ grant all on *.* to 'root'@'%' identified by 'Test@2020.M';
    $ flush privileges;

    # 注意要在防火墙开放 3306 端口给 core 和 koko 服务器访问


**2.1 编辑资产树**
------------------------

.. code-block:: vim

    # 点击页面左侧的"资产管理"-"资产列表"
    # 注: 根节点"Default"不能重名, 右击节点可以添加、删除和重命名节点, 以及进行资产相关的操作

    # 先在根节点 Default 右键新建 SSH Server 和 RDP Server 两个节点

**2.2 创建管理用户**
------------------------

.. code-block:: vim

    # 点击页面左侧的"资产管理"-"管理用户"-"新建管理用户" 创建两个管理用户, 管理用户的内容就是上面表单的 Admin User 和 Password
    # "名称" 172.16.80.11_root
    # "用户名" root
    # "密码" Test@2020.L
    # 点击保存

    # 再创建 Windows 资产的"管理用户"
    # "名称" 172.16.80.21_administrator
    # "用户名" administrator
    # "密码" Test@2020.W
    # 点击保存

    # 名称不能重名, 密码或者密钥二选一即可, 一些资产不允许通过 密码 认证可以改用 私钥 认证

**2.3 创建资产**
------------------------

.. code-block:: vim

    # 点击页面左侧的"资产管理"-"资产列表"-"创建资产" 把两个资产导入
    # "主机名" test_ssh01
    # "IP" 172.16.80.11
    # "系统平台" Linux
    # "协议组" ssh 22
    # "管理用户" 172.16.80.11_root
    # "节点" Default / SSH Server
    # 点击保存

    # 再创建 Windows 资产, 注意协议组我们需要选择两个协议, ssh 和 rdp, 否则无法获取 Windows 资产的状态及硬件信息
    # "主机名" 172.16.80.21_administrator
    # "IP" 172.16.80.21
    # "系统平台" Windows2016
    # "协议组" rdp 3389 / ssh 22
    # "管理用户" test_test_rdp01_administrator
    # "节点" Default / RDP Server
    # 点击保存

    # 主机名不能重名

.. code-block:: vim

    # 资产创建信息填写好保存之后隔几秒钟时间刷新一下网页, ssh 协议资产的可连接图标会显示绿色, 且硬件信息会显示出来
    # 如果 可连接 的图标是 黄色 或者 红色 , 可以点击资产的名称，在右侧 快速修改-测试可连接性 点击"测试" 按钮, 根据错误提示处理

    # 被连接 Linux 资产需要"python"组件, 且版本大于等于2.6, Ubuntu等资产默认不允许root用户远程ssh登录, 请自行处理, Windows 资产需要手动安装 OpenSSH Server
    # 如果资产不能正常连接, 请检查"管理用户"的用户名和密钥是否正确以及该"管理用户"是否能使用 SSH 从 JumpServer 主机正确登录到资产主机上

.. code-block:: vim

    # 击页面左侧的"应用管理"-"数据库应用"-"创建数据库应用" 创建 mysql 数据库
    # "名称" test_mysql01
    # "类型" MySQL
    # "主机" 172.16.80.31
    # "端口" 3306

    # 数据库 选项可以留空, 如果是某些特定用户, 只允许访问指定的数据库, 这里指定数据库名称即可

**2.4 创建系统用户**
------------------------
- 用户权限图

+--------------+------------+---------------+---------------+--------------+--------------+-------------+
|      IP      |   System   |  System User  |    Password   |     Group    |     Sudo     |  Sftp Root  |
+==============+============+===============+===============+==============+==============+=============+
| 172.16.80.11 |  Centos 7  |   testssh01   |  random pass  |              |      ALL     |      /      |
+--------------+------------+---------------+---------------+--------------+--------------+-------------+
| 172.16.80.21 | Windows 10 |   testrdp01   |  random pass  |     Users    |              |             |
+--------------+------------+---------------+---------------+--------------+--------------+-------------+
| 172.16.80.23 |   Mysql 5  |      root     |  Test@2020.M  |              |              |             |
+--------------+------------+---------------+---------------+--------------+--------------+-------------+

.. code-block:: vim

    # 在理解系统用户之前, 你首先得知道系统用户是干嘛用的. 在 Jumpserver 中, 需要对资产不同的用途创建不同的系统用户
    # 比如一个资产, 开发要用、测试要用、可能还要其他的部门也要使用, 偷懒的人可能会统一给 root 用户, 但是这样并不安全
    # 系统用户就是为了解决这个问题, 我们针对不同的用途创建不同的系统用户, Linux 通过 Sudo 来控制用户的权限, Windows 通过组来控制用户权限

    # 点击页面左侧的"资产管理"-"系统用户"-"创建系统用户" 创建两个系统用户
    # "名称" test_ssh01_测试系统用户
    # "登录模式" 自动登陆
    # "用户名" testssh01
    # "协议" ssh
    # "Sudo" ALL
    # "SFTP根路径" /
    # 其他选项默认, 点击保存

    # 再创建 Windows 系统用户
    # "名称" test_rdp01_测试系统用户
    # "登录模式" 自动登陆
    # "用户名" testrdp01
    # "协议" rdp
    # 其他选项默认, 点击保存

    # 创建 MySQL 系统用户
    # "名称" test_mysql01_测试系统用户
    # "登录模式" 自动登陆
    # "用户名" root
    # "协议" mysql
    # "密码" Test@2020.M
    # 其他选项默认, 点击保存

三、创建授权规则
`````````````````````

**3.1 为用户分配资产**
----------------------

+--------------+------------+---------------+-----------------+
|      IP      |   System   |  System User  | Jumpserver User |
+==============+============+===============+=================+
| 172.16.80.11 |  Centos 7  |   testssh01   |      admin      |
+--------------+------------+---------------+-----------------+
| 172.16.80.21 | Windows 10 |   testrdp01   |      admin      |
+--------------+------------+---------------+-----------------+
| 172.16.80.31 |  Mysql 5   |      root     |      admin      |
+--------------+------------+---------------+-----------------+

.. code-block:: vim

    # 点击页面左侧的"授权管理"-"资产授权"-"创建授权规则" 创建两个授权
    # "名称" test_ssh01_测试授权
    # "用户" Administrator(admin)
    # "资产" test_ssh01(172.16.80.11)
    # "系统用户" test_ssh01_测试系统用户(testssh01)
    # 有效期时间自行定义, 用户只能在有效期时间内连接资产, 修改完成后点击保存

    # 再创建 Windows 授权
    # "名称" test_rdp01_测试授权
    # "用户" Administrator(admin)
    # "资产" test_rdp01(172.16.80.21)
    # "系统用户" test_rdp01_测试系统用户(testrdp01)
    # 修改完成后点击保存

    # "名称", 授权的名称, 不能重复
    # "用户"和"用户组"二选一, 不推荐即选择用户又选择用户组
    # "资产"和"节点"二选一, 选择节点会包含节点下面的所有资产
    # "系统用户", 及所选的用户或用户组下的用户能通过该系统用户使用所选节点或者节点下的资产
    # 用户(组), 资产(节点), 系统用户是一对一的关系, 所以当拥有 Linux、Windows 不同类型资产时, 应该分别给 Linux 资产和 Windows 资产创建授权规则

一般情况下, 资产授权给个人, 节点授权给用户组, 一个授权只能选择一个系统用户

.. code-block:: vim

    # 点击页面左侧的"授权管理"-"数据库应用"-"创建授权规则" 创建数据库授权
    # "名称" test_mysql01_测试授权
    # "用户" Administrator(admin)
    # "数据库应用" test_mysql01
    # "系统用户" test_mysql01_测试系统用户(root)
    # 修改完成后点击保存

四、用户登录
`````````````````````

**4.1 登录 JumpServer**
-----------------------

.. code-block:: vim

    # 点击页面左侧的"会话管理"-"Web终端"
    # 用户只能看到自己被管理员授权了的"资产", 如果登录后无资产, 请联系管理员进行确认

**4.2 连接资产**
-----------------------

.. code-block:: vim

    # 在我的资产点击资产右边的 "连接" 快速连接资产
    # 也可以点击左侧栏的 "Web终端"
    # 点击 "资产" 名字, 就连上资产了
    # 如果显示连接超时, 请参考 FAQ 文档进行处理

**4.3 断开资产**
-----------------------

.. code-block:: vim

    # 点击页面顶部的 "Server" 按钮会弹出选个选项, 第一个断开所选的连接, 第二个断开所有连接。
    # 也可以直接点资产小窗口的 X , SSH 会话也可以输入 exit 来退出
    # 直接关闭页面也可以, 但是不推荐

**4.4 文件管理**
-----------------------

.. code-block:: vim

    # 点击 "文件管理"
    # 先在左边选择资产, 目前只支持自动登录的 SSH 协议资产
    # 也可以使用 sftp 方式进行文件管理

以上就是 JumpServer 的简易入门了, JumpServer 还有很多功能等待您去发现。在使用过程中, 如果遇到什么问题, 可以在文档的"联系方式"一栏找到我们。
